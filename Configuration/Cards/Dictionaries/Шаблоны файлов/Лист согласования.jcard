[
  {
    ".method::int": 2,
    "Card": {
      "Created::dtm": "2020-07-13T12:33:27.617Z",
      "CreatedByID::uid": "3db19fa0-228a-497f-873a-0250bf0a4ccb",
      "CreatedByName": "Admin",
      "Files": [
        {
          ".flags::int": 0,
          ".state::int": 4,
          ".versionsLoaded": false,
          "Card": {
            "Created::dtm": "2020-07-13T12:33:27.617Z",
            "CreatedByID::uid": "3db19fa0-228a-497f-873a-0250bf0a4ccb",
            "CreatedByName": "Admin",
            "Flags::int": 0,
            "ID::uid": "a73f73ca-dece-472a-8a59-a3a1e5ef5a16",
            "Info": null,
            "Modified::dtm": "2020-07-13T12:33:27.617Z",
            "ModifiedByID::uid": "3db19fa0-228a-497f-873a-0250bf0a4ccb",
            "ModifiedByName": "Admin",
            "Permissions": null,
            "Sections": null,
            "TypeCaption": "$CardTypes_TypesNames_File",
            "TypeID::uid": "ab387c69-fd62-0655-bbc3-b879e433a143",
            "TypeName": "File",
            "Version::int": 67
          },
          "CategoryCaption": null,
          "CategoryID": null,
          "ExternalSource": null,
          "Hash": null,
          "Info": null,
          "IsVirtual": false,
          "Name": "{$ApprovalHistory_Name_Default}.html",
          "NewVersionTags": null,
          "Options": null,
          "OriginalFileID": null,
          "OriginalVersionRowID": null,
          "RequestInfo": null,
          "RowID::uid": "a73f73ca-dece-472a-8a59-a3a1e5ef5a16",
          "SectionRows": null,
          "Size": 31538,
          "StoreSource::int": 1,
          "TaskID": null,
          "TypeCaption": "$CardTypes_TypesNames_File",
          "TypeID::uid": "ab387c69-fd62-0655-bbc3-b879e433a143",
          "TypeName": "File",
          "VersionNumber::int": 67,
          "VersionRowID::uid": "7fc21a9f-dc3e-44a6-859c-cd4fdebeaa96",
          "Versions": null
        }
      ],
      "Flags::int": 0,
      "ID::uid": "9cf3a99f-3818-4176-b1d5-df44a2217160",
      "Info": null,
      "Modified::dtm": "2020-07-13T12:33:27.617Z",
      "ModifiedByID::uid": "3db19fa0-228a-497f-873a-0250bf0a4ccb",
      "ModifiedByName": "Admin",
      "Permissions": null,
      "Sections": {
        "FileTemplateRoles": {
          ".table::int": 1,
          "Rows": [
            {
              "RoleID::uid": "11111111-1111-1111-1111-111111111111",
              "RoleName": "System",
              "RowID::uid": "28e33c9a-26a3-47a6-b8c6-f92b67808802"
            }
          ]
        },
        "FileTemplates": {
          "Fields": {
            "AfterDocumentReplace": "",
            "AfterPlaceholderReplace": null,
            "AfterRowReplace": null,
            "AfterTableReplace": null,
            "AliasMetadata": null,
            "BeforeDocumentReplace": null,
            "BeforePlaceholderReplace": null,
            "BeforeRowReplace": null,
            "BeforeTableReplace": null,
            "GroupName": "$ApprovalHistory_Name_Default",
            "Name": "$ApprovalHistory_Name_Default",
            "System": true,
            "TypeID::int": 0,
            "TypeName": "$FileTemplateType_Card"
          }
        },
        "FileTemplateTypes": {
          ".table::int": 1,
          "Rows": null
        },
        "FileTemplateViews": {
          ".table::int": 1,
          "Rows": null
        }
      },
      "TaskHistory": null,
      "TaskHistoryGroups": null,
      "Tasks": null,
      "Topics": null,
      "TypeCaption": "$CardTypes_TypesNames_FileTemplate",
      "TypeID::uid": "b7e1b93e-eeda-49b7-9402-2471d4d14bdf",
      "TypeName": "FileTemplate",
      "Version::int": 0
    },
    "FileMapping": null,
    "Info": {
      ".importVersion::int": 8
    }
  },
  {
    ".id::uid": "a73f73ca-dece-472a-8a59-a3a1e5ef5a16",
    ".size": 31538,
    "Content::bin": "77u/PCMNCiNyZWZlcmVuY2UgU3lzdGVtLldlYjsNCiN1c2luZyBTeXN0ZW0uV2ViOw0KI3VzaW5nIFN5c3RlbS5EYXRhOw0KI3VzaW5nIFRlc3NhLkNhcmRzLkNhY2hpbmc7DQojdXNpbmcgVGVzc2EuRXh0ZW5zaW9ucy5EZWZhdWx0LlNoYXJlZDsgDQojdXNpbmcgVGVzc2EuRXh0ZW5zaW9ucy5EZWZhdWx0LlNoYXJlZC5WaXJ0dWFsRmlsZXM7IA0KI3VzaW5nIFRlc3NhLkV4dGVuc2lvbnMuRGVmYXVsdC5TaGFyZWQuV29ya2Zsb3cuS3JQcm9jZXNzOw0KDQovLyDQoi7Qui4g0LIg0YTQsNC50LvQtSDQtdGB0YLRjCDRgdGB0YvQu9C60LAg0L3QsCDQtdCz0L4g0LTRgNGD0LPRg9GOINCy0LXRgNGB0LjRjiwg0L/QuNGI0LXQvCBJRCDQstC40YDRgtGD0LDQu9GM0L3QvtCz0L4g0YTQsNC50LvQsCDQuCDQv9C10YfQsNGC0L3QvtC5INCy0LXRgNGB0LjQuCDRhNCw0LnQu9CwINC30LTQtdGB0YwNCnZhciB2aXJ0dWFsRmlsZUlEID0gS3JWaXJ0dWFsRmlsZXNIZWxwZXIuQXBwcm92YWxMaXN0RmlsZUlEOw0KdmFyIHByaW50YWJsZVZlcnNpb25JRCA9IEtyVmlydHVhbEZpbGVzSGVscGVyLkFwcHJvdmFsTGlzdFByaW50YWJsZVZlcnNpb25JRDsNCg0KLy8g0JjQvdC40YbQuNCw0LvQuNC30LDRhtC40Y8g0LLQsNC20L3Ri9GFINC/0LDRgNCw0LzQtdGC0YDQvtCyDQp2YXIgYXNjZW5kaW5nT3JkZXIgPSAoYXdhaXQgY29udGV4dC5Db250YWluZXIuUmVzb2x2ZTxJQ2FyZENhY2hlPigpLkNhcmRzLkdldEFzeW5jKCJLclNldHRpbmdzIikpDQogICAgICAgICAgICAgICAgICAgIC5TZWN0aW9uc1siS3JTZXR0aW5ncyJdDQogICAgICAgICAgICAgICAgICAgIC5SYXdGaWVsZHMNCiAgICAgICAgICAgICAgICAgICAgLkdldDxib29sPigiQXNjZW5kaW5nQXBwcm92YWxMaXN0Iik7DQoNCnZhciB3ZWJDbGllbnQgPSBjb250ZXh0LlNlc3Npb24uSXNXZWJDbGllbnQoKTsNCnZhciB3ZWJBZGRyZXNzID0gYXdhaXQgQ2FyZEhlbHBlci5UcnlHZXRXZWJBZGRyZXNzQXN5bmMoY29udGV4dC5Db250YWluZXIuUmVzb2x2ZTxJQ2FyZENhY2hlPigpKTsNCnZhciBpc1ByaW50YWJsZSA9IGNvbnRleHQuSW5mby5UcnlHZXQ8Ym9vbD4oIlByaW50YWJsZUxpc3QiKTsNCnZhciBjYXJkSUQgPSBhd2FpdCBjb250ZXh0LkdldENhcmRJREFzeW5jKCk7DQoNCnZhciBpZ25vcmVUeXBlcyA9IG5ldyBHdWlkW10NCnsgICBuZXcgR3VpZCgweDc1YWY3ZGY4LCAweGVlYjksIDB4NGQ1ZCwgMHg4YSwgMHhmOSwgMHg1MywgMHg4MiwgMHgxNSwgMHg5ZiwgMHhkYiwgMHhiMiksICAvLyA3NWFmN2RmOC1lZWI5LTRkNWQtOGFmOS01MzgyMTU5ZmRiYjINCiAgICBuZXcgR3VpZCgweGZjNmY2ZTcxLCAweGNiOWMsIDB4NDkwMiwgMHhiOSwgMHhmNSwgMHhkNiwgMHhiYSwgMHgyMiwgMHgzMSwgMHg3NCwgMHhkOCksICAvLyBmYzZmNmU3MS1jYjljLTQ5MDItYjlmNS1kNmJhMjIzMTc0ZDgNCiAgICBEZWZhdWx0VGFza1R5cGVzLktyUmVxdWVzdENvbW1lbnRUeXBlSUQsDQogICAgRGVmYXVsdFRhc2tUeXBlcy5LckluZm9SZXF1ZXN0Q29tbWVudFR5cGVJRA0KfTsNCg0Kc3RyaW5nIHJlc3VsdFBlcmNlbnQgPSBpc1ByaW50YWJsZSA/ICI0NyIgOiAiMzciOw0KDQpjb250ZXh0LkluZm9bIldlYkNsaWVudCJdID0gd2ViQ2xpZW50Ow0KY29udGV4dC5JbmZvWyJXZWJBZGRyZXNzIl0gPSB3ZWJBZGRyZXNzOw0KY29udGV4dC5JbmZvWyJBc2NlbmRpbmdPcmRlciJdID0gYXNjZW5kaW5nT3JkZXI7DQpjb250ZXh0LkluZm9bIklzUHJpbnRhYmxlIl0gPSBpc1ByaW50YWJsZTsNCmNvbnRleHQuSW5mb1siSWdub3JlVHlwZXMiXSA9IGlnbm9yZVR5cGVzOw0KY29udGV4dC5JbmZvWyJSZXN1bHRQZXJjZW50Il0gPSByZXN1bHRQZXJjZW50Ow0KDQpzdHJpbmcgRm9ybWF0VGV4dChzdHJpbmcgdGV4dCkNCnsNCiAgICByZXR1cm4gdGV4dCAhPSBudWxsID8gSHR0cFV0aWxpdHkuSHRtbEVuY29kZSh0ZXh0KSA6IG51bGw7DQp9DQoNCnN0cmluZyBGb3JtYXRGaWxlTGluayhLckhpc3RvcnlGaWxlSXRlbSBmaWxlSXRlbSkNCnsNCiAgICBzdHJpbmcgZW5jb2RlZEZpbGVOYW1lID0gRm9ybWF0VGV4dChmaWxlSXRlbS5GaWxlTmFtZSk7DQoNCiAgICBpZiAoaXNQcmludGFibGUpDQogICAgew0KICAgICAgICByZXR1cm4gZW5jb2RlZEZpbGVOYW1lOw0KICAgIH0NCiAgICANCiAgICBzdHJpbmcgbGlua1RleHQgPSB3ZWJDbGllbnQNCiAgICAgICAgPyBDYXJkSGVscGVyLkdldFdlYkZpbGVMaW5rKA0KICAgICAgICAgICAgd2ViQWRkcmVzcywNCiAgICAgICAgICAgIGNhcmRJRCwNCiAgICAgICAgICAgIGZpbGVJdGVtLkZpbGVJRCwNCiAgICAgICAgICAgIGZpbGVJdGVtLlZlcnNpb25Sb3dJRCwNCiAgICAgICAgICAgIGZpbGVOYW1lOiBlbmNvZGVkRmlsZU5hbWUsDQogICAgICAgICAgICBhc0h0bWw6IGZhbHNlKQ0KICAgICAgICA6IENhcmRIZWxwZXIuR2V0TGluaygNCiAgICAgICAgICAgIGNvbnRleHQuU2Vzc2lvbiwNCiAgICAgICAgICAgIGNhcmRJRCwNCiAgICAgICAgICAgIGZpbGVJdGVtLkZpbGVJRCwNCiAgICAgICAgICAgIGZpbGVJdGVtLlZlcnNpb25Sb3dJRCk7DQoNCiAgICByZXR1cm4gIjxhICIgKyAod2ViQ2xpZW50ID8gInRhcmdldD1cIl9ibGFua1wiIHJlbD1cIm5vb3BlbmVyIG5vcmVmZXJyZXJcIiIgOiBzdHJpbmcuRW1wdHkpICsgImhyZWY9XCIiICsgbGlua1RleHQgKyAiXCI+IiArIGVuY29kZWRGaWxlTmFtZSArICI8L2E+IjsNCn0NCg0KY29udGV4dC5JbmZvWyJGb3JtYXRGaWxlTGlua0Z1bmMiXSA9IG5ldyBGdW5jPEtySGlzdG9yeUZpbGVJdGVtLCBzdHJpbmc+KHggPT4gRm9ybWF0RmlsZUxpbmsoeCkpOw0KDQovLyDQnNC10YLQvtC0INC00LvRjyDQv9C+0LvRg9GH0LXQvdC40Y8g0LrQstCw0L3RgtC+0LIg0YEg0LzQvtC80LXQvdGC0LAg0YHQvtC30LTQsNC90LjRjywg0YEg0LzQvtC80LXQvdGC0LAg0LLQt9GP0YLQuNGPINCyINGA0LDQsdC+0YLRgyDQuCDQvNC+0LzQtdC90YLQsCDQtNC+INC40YHRgtC10YfQtdC90LjRjyDRgdGA0L7QutCwINC30LDQtNCw0L3QuNGPICjQuNC70Lgg0YDQsNGB0YfQtdGCINC/0YDQvtGB0YDQvtGH0LrQuCkNCmFzeW5jIFRhc2s8RGljdGlvbmFyeTxHdWlkLCAoaW50PywgaW50PywgaW50Pyk+PiBHZXRBcHByb3ZhbFRhc2tJdGVtc0FzeW5jKElEYlNjb3BlIGRiU2NvcGUpDQp7DQogICAgdmFyIGl0ZW1zID0gbmV3IERpY3Rpb25hcnk8R3VpZCwgKGludD8sIGludD8sIGludD8pPigpOw0KICAgIHVzaW5nIChkYlNjb3BlLkNyZWF0ZSgpKQ0KICAgIHsNCiAgICAgICAgdmFyIGRiID0gZGJTY29wZS5EYjsNCiAgICAgICAgdmFyIGJ1aWxkZXJGYWN0b3J5ID0gZGJTY29wZS5CdWlsZGVyRmFjdG9yeTsNCg0KICAgICAgICBkYg0KICAgICAgICAgICAgLlNldENvbW1hbmQoDQogICAgICAgICAgICAgICAgYnVpbGRlckZhY3RvcnkNCiAgICAgICAgICAgICAgICAgICAgLlNlbGVjdCgpLkMoInQiLCAiUm93SUQiKQ0KICAgICAgICAgICAgICAgICAgICAuQ2FzdEFzKGIgPT4gYi5DKCJjcTQiLCAiUXVhbnROdW1iZXIiKS5TdWJzdHJhY3QoKS5DKCJjcTEiLCAiUXVhbnROdW1iZXIiKSwgRGJUeXBlLkludDMyKS5BcygiQ3JlYXRlZFF1YW50cyIpDQogICAgICAgICAgICAgICAgICAgIC5DYXN0QXMoYiA9PiBiLkMoImNxNCIsICJRdWFudE51bWJlciIpLlN1YnN0cmFjdCgpLkMoImNxMiIsICJRdWFudE51bWJlciIpLCBEYlR5cGUuSW50MzIpLkFzKCJJblByb2dyZXNzUXVhbnRzIikNCiAgICAgICAgICAgICAgICAgICAgLkNhc3RBcyhiID0+IGIuQygiY3EzIiwgIlF1YW50TnVtYmVyIikuU3Vic3RyYWN0KCkuQygiY3E0IiwgIlF1YW50TnVtYmVyIiksIERiVHlwZS5JbnQzMikuQXMoIlJlbWFpbmluZ1F1YW50cyIpDQogICAgICAgICAgICAgICAgICAgIC5Gcm9tKCJUYXNrcyIsICJ0IikuTm9Mb2NrKCkNCiAgICAgICAgICAgICAgICAgICAgLklubmVySm9pbigiS3JBY3RpdmVUYXNrcyIsICJrYXQiKS5Ob0xvY2soKQ0KICAgICAgICAgICAgICAgICAgICAgICAgLk9uKCkuQygia2F0IiwgIlRhc2tJRCIpLkVxdWFscygpLkMoInQiLCAiUm93SUQiKQ0KICAgICAgICAgICAgICAgICAgICAuTGVmdEpvaW5MYXRlcmFsKGIgPT4gYg0KICAgICAgICAgICAgICAgICAgICAgICAgLlNlbGVjdCgpLlRvcCgxKS5DKCJxIiwgIlF1YW50TnVtYmVyIikNCiAgICAgICAgICAgICAgICAgICAgICAgIC5Gcm9tKCJDYWxlbmRhclF1YW50cyIsICJxIikuTm9Mb2NrKCkNCiAgICAgICAgICAgICAgICAgICAgICAgIC5XaGVyZSgpLkMoInEiLCAiU3RhcnRUaW1lIikuTGVzc09yRXF1YWxzKCkuQygidCIsICJDcmVhdGVkIikNCiAgICAgICAgICAgICAgICAgICAgICAgIC5PcmRlckJ5KCJxIiwgIlN0YXJ0VGltZSIsIFNvcnRPcmRlci5EZXNjZW5kaW5nKQ0KICAgICAgICAgICAgICAgICAgICAgICAgLkxpbWl0KDEpLA0KICAgICAgICAgICAgICAgICAgICAgICAgImNxMSIpDQogICAgICAgICAgICAgICAgICAgIC5MZWZ0Sm9pbkxhdGVyYWwoYiA9PiBiDQogICAgICAgICAgICAgICAgICAgICAgICAuU2VsZWN0KCkuVG9wKDEpLkMoInEiLCAiUXVhbnROdW1iZXIiKQ0KICAgICAgICAgICAgICAgICAgICAgICAgLkZyb20oIkNhbGVuZGFyUXVhbnRzIiwgInEiKS5Ob0xvY2soKQ0KICAgICAgICAgICAgICAgICAgICAgICAgLldoZXJlKCkuQygicSIsICJTdGFydFRpbWUiKS5MZXNzT3JFcXVhbHMoKS5DKCJ0IiwgIkluUHJvZ3Jlc3MiKQ0KICAgICAgICAgICAgICAgICAgICAgICAgLk9yZGVyQnkoInEiLCAiU3RhcnRUaW1lIiwgU29ydE9yZGVyLkRlc2NlbmRpbmcpDQogICAgICAgICAgICAgICAgICAgICAgICAuTGltaXQoMSksDQogICAgICAgICAgICAgICAgICAgICAgICAiY3EyIikNCiAgICAgICAgICAgICAgICAgICAgLkxlZnRKb2luTGF0ZXJhbChiID0+IGINCiAgICAgICAgICAgICAgICAgICAgICAgIC5TZWxlY3QoKS5Ub3AoMSkuQygicSIsICJRdWFudE51bWJlciIpDQogICAgICAgICAgICAgICAgICAgICAgICAuRnJvbSgiQ2FsZW5kYXJRdWFudHMiLCAicSIpLk5vTG9jaygpDQogICAgICAgICAgICAgICAgICAgICAgICAuV2hlcmUoKS5DKCJxIiwgIlN0YXJ0VGltZSIpLkxlc3NPckVxdWFscygpLkMoInQiLCAiUGxhbm5lZCIpDQogICAgICAgICAgICAgICAgICAgICAgICAuT3JkZXJCeSgicSIsICJTdGFydFRpbWUiLCBTb3J0T3JkZXIuRGVzY2VuZGluZykNCiAgICAgICAgICAgICAgICAgICAgICAgIC5MaW1pdCgxKSwNCiAgICAgICAgICAgICAgICAgICAgICAgICJjcTMiKQ0KICAgICAgICAgICAgICAgICAgICAuQ3Jvc3NKb2luKGIgPT4gYg0KICAgICAgICAgICAgICAgICAgICAgICAgLlNlbGVjdCgpLlRvcCgxKS5DKCJxIiwgIlF1YW50TnVtYmVyIikNCiAgICAgICAgICAgICAgICAgICAgICAgIC5Gcm9tKCJDYWxlbmRhclF1YW50cyIsICJxIikuTm9Mb2NrKCkNCiAgICAgICAgICAgICAgICAgICAgICAgIC5XaGVyZSgpLkMoInEiLCAiU3RhcnRUaW1lIikuTGVzc09yRXF1YWxzKCkuUCgiRGF0ZSIpDQogICAgICAgICAgICAgICAgICAgICAgICAuT3JkZXJCeSgicSIsICJTdGFydFRpbWUiLCBTb3J0T3JkZXIuRGVzY2VuZGluZykNCiAgICAgICAgICAgICAgICAgICAgICAgIC5MaW1pdCgxKSwNCiAgICAgICAgICAgICAgICAgICAgICAgICJjcTQiKQ0KICAgICAgICAgICAgICAgICAgICAuV2hlcmUoKS5DKCJ0IiwgIklEIikuRXF1YWxzKCkuUCgiSUQiKQ0KICAgICAgICAgICAgICAgICAgICAuQnVpbGQoKSwNCiAgICAgICAgICAgICAgICBkYi5QYXJhbWV0ZXIoIklEIiwgY2FyZElEKSwNCiAgICAgICAgICAgICAgICBkYi5QYXJhbWV0ZXIoIkRhdGUiLCBEYXRlVGltZS5VdGNOb3cpKQ0KICAgICAgICAgICAgLkxvZ0NvbW1hbmQoKTsNCg0KICAgICAgICB1c2luZyAodmFyIHJlYWRlciA9IGF3YWl0IGRiLkV4ZWN1dGVSZWFkZXJBc3luYygpKQ0KICAgICAgICB7DQogICAgICAgICAgICB3aGlsZSAoYXdhaXQgcmVhZGVyLlJlYWRBc3luYygpKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGl0ZW1zW3JlYWRlci5HZXRWYWx1ZTxHdWlkPigwKV0gPSAocmVhZGVyLkdldFZhbHVlPGludD8+KDEpLCByZWFkZXIuR2V0VmFsdWU8aW50Pz4oMiksIHJlYWRlci5HZXRWYWx1ZTxpbnQ/PigzKSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICB9DQoNCiAgICByZXR1cm4gaXRlbXM7DQp9DQoNCi8vINCc0LXRgtC+0LQg0LTQu9GPINC/0L7Qu9GD0YfQtdC90LjRjyDQvdC10L7QsdGF0L7QtNC40LzQvtC5INC40L3RhNC+0YDQvNCw0YbQuNC4INC+INGE0LDQudC70LDRhSDQtNC70Y8g0LjRgdGC0L7RgNC40Lgg0LfQsNC00LDQvdC40LksINCwINGC0LDQutC20LUg0YDQsNGB0YfQtdGCINC60LLQsNC90YLQvtCyINGBINC80L7QvNC10L3RgtCwINC30LDQstC10YDRiNC10L3QuNGPINC30LDQtNCw0L3QuNGPDQphc3luYyBUYXNrPERpY3Rpb25hcnk8R3VpZCwgS3JIaXN0b3J5SXRlbT4+IEdldEFwcHJvdmFsSGlzdG9yeUl0ZW1zQXN5bmMoDQogICAgICAgICAgICBJRGJTY29wZSBkYlNjb3BlKQ0Kew0KICAgIHZhciBpdGVtcyA9IG5ldyBEaWN0aW9uYXJ5PEd1aWQsIEtySGlzdG9yeUl0ZW0+KCk7DQogICAgdXNpbmcgKGRiU2NvcGUuQ3JlYXRlKCkpDQogICAgew0KICAgICAgICB2YXIgZGIgPSBkYlNjb3BlLkRiOw0KICAgICAgICB2YXIgYnVpbGRlciA9IGRiU2NvcGUuQnVpbGRlckZhY3RvcnkNCiAgICAgICAgICAgIC5TZWxlY3QoKQ0KICAgICAgICAgICAgICAgIC5DKCJ0aCIsICJSb3dJRCIpDQogICAgICAgICAgICAgICAgLkMoImZ2IiwgIklEIiwgIkNyZWF0ZWQiLCAiUm93SUQiLCAiTmFtZSIpDQogICAgICAgICAgICAgICAgLkMoImtyIiwgIkN5Y2xlIikNCiAgICAgICAgICAgICAgICAuQ2FzdEFzKGIgPT4gYi5DKCJjcTIiLCAiUXVhbnROdW1iZXIiKS5TdWJzdHJhY3QoKS5DKCJjcTEiLCAiUXVhbnROdW1iZXIiKSwgRGJUeXBlLkludDMyKS5BcygiQ29tcGxldGVkUXVhbnRzIikNCiAgICAgICAgICAgIC5Gcm9tKCJLckFwcHJvdmFsSGlzdG9yeSIsICJrciIpLk5vTG9jaygpDQogICAgICAgICAgICAuSW5uZXJKb2luKCJUYXNrSGlzdG9yeSIsICJ0aCIpLk5vTG9jaygpDQogICAgICAgICAgICAgICAgLk9uKCkuQygidGgiLCAiUm93SUQiKS5FcXVhbHMoKS5DKCJrciIsICJIaXN0b3J5UmVjb3JkIikNCiAgICAgICAgICAgIC5MZWZ0Sm9pbkxhdGVyYWwoYiA9PiBiDQogICAgICAgICAgICAgICAgLlNlbGVjdCgpLkMoInYiLCAiUm93SUQiLCAiSUQiLCAiQ3JlYXRlZCIsICJOYW1lIikNCiAgICAgICAgICAgICAgICAuRnJvbSgiRmlsZXMiLCAiZiIpLk5vTG9jaygpDQogICAgICAgICAgICAgICAgLklubmVySm9pbigiRmlsZVZlcnNpb25zIiwgInYiKS5Ob0xvY2soKQ0KICAgICAgICAgICAgICAgICAgICAuT24oKS5DKCJ2IiwgIklEIikuRXF1YWxzKCkuQygiZiIsICJSb3dJRCIpDQogICAgICAgICAgICAgICAgLldoZXJlKCkuQygiZiIsICJJRCIpLkVxdWFscygpLkMoInRoIiwgIklEIikNCiAgICAgICAgICAgICAgICAgICAgLkFuZCgpLkMoInYiLCAiU3RhdGVJRCIpLkVxdWFscygpLlYoMSkNCiAgICAgICAgICAgICAgICAgICAgLkFuZCgpLkMoInYiLCAiQ3JlYXRlZEJ5SUQiKS5FcXVhbHMoKS5DKCJ0aCIsICJVc2VySUQiKQ0KICAgICAgICAgICAgICAgICAgICAuQW5kKCkuQygidiIsICJDcmVhdGVkIikuR3JlYXRlcigpLkMoInRoIiwgIkNyZWF0ZWQiKQ0KICAgICAgICAgICAgICAgICAgICAuQW5kKCkuQygidiIsICJDcmVhdGVkIikuTGVzc09yRXF1YWxzKCkuQygidGgiLCAiQ29tcGxldGVkIiksDQogICAgICAgICAgICAgICAgImZ2IikNCiAgICAgICAgICAgIC5MZWZ0Sm9pbkxhdGVyYWwoYiA9PiBiDQogICAgICAgICAgICAgICAgLlNlbGVjdCgpLlRvcCgxKS5DKCJxIiwgIlF1YW50TnVtYmVyIikNCiAgICAgICAgICAgICAgICAuRnJvbSgiQ2FsZW5kYXJRdWFudHMiLCAicSIpLk5vTG9jaygpDQogICAgICAgICAgICAgICAgLldoZXJlKCkuQygicSIsICJTdGFydFRpbWUiKS5MZXNzT3JFcXVhbHMoKS5DKCJ0aCIsICJDcmVhdGVkIikNCiAgICAgICAgICAgICAgICAuT3JkZXJCeSgicSIsICJTdGFydFRpbWUiLCBTb3J0T3JkZXIuRGVzY2VuZGluZykNCiAgICAgICAgICAgICAgICAuTGltaXQoMSksDQogICAgICAgICAgICAgICAgImNxMSIpDQogICAgICAgICAgICAuTGVmdEpvaW5MYXRlcmFsKGIgPT4gYg0KICAgICAgICAgICAgICAgIC5TZWxlY3QoKS5Ub3AoMSkuQygicSIsICJRdWFudE51bWJlciIpDQogICAgICAgICAgICAgICAgLkZyb20oIkNhbGVuZGFyUXVhbnRzIiwgInEiKS5Ob0xvY2soKQ0KICAgICAgICAgICAgICAgIC5XaGVyZSgpLkMoInEiLCAiU3RhcnRUaW1lIikuTGVzc09yRXF1YWxzKCkuQygidGgiLCAiQ29tcGxldGVkIikNCiAgICAgICAgICAgICAgICAuT3JkZXJCeSgicSIsICJTdGFydFRpbWUiLCBTb3J0T3JkZXIuRGVzY2VuZGluZykNCiAgICAgICAgICAgICAgICAuTGltaXQoMSksDQogICAgICAgICAgICAgICAgImNxMiIpDQogICAgICAgICAgICAuV2hlcmUoKS5DKCJ0aCIsICJJRCIpLkVxdWFscygpLlAoIklEIikNCiAgICAgICAgICAgICAgICAuQW5kKCkuQygidGgiLCAiQ29tcGxldGVkIikuSXNOb3ROdWxsKCkNCiAgICAgICAgICAgICAgICAuQW5kKCkuQygidGgiLCAiVHlwZUlEIikuTm90SW4oaWdub3JlVHlwZXMpDQogICAgICAgICAgICAgICAgLkFuZCgpLk5vdCgpLkUocSA9PiANCiAgICAgICAgICAgICAgICAgICAgcS5DKCJ0aCIsICJUeXBlSUQiKS5FcXVhbHMoKS5WKERlZmF1bHRUYXNrVHlwZXMuS3JJbmZvQWRkaXRpb25hbEFwcHJvdmFsVHlwZUlEKQ0KICAgICAgICAgICAgICAgICAgICAgICAgLkFuZCgpLkMoInRoIiwgIk9wdGlvbklEIikuRXF1YWxzKCkuVihEZWZhdWx0Q29tcGxldGlvbk9wdGlvbnMuQWRkaXRpb25hbEFwcHJvdmFsKSkNCiAgICAgICAgICAgIC5PcmRlckJ5KCJrciIsICJDeWNsZSIsIFNvcnRPcmRlci5EZXNjZW5kaW5nKQ0KICAgICAgICAgICAgLkJ5KCJ0aCIsICJDb21wbGV0ZWQiLCBTb3J0T3JkZXIuRGVzY2VuZGluZykNCiAgICAgICAgICAgIC5CeSgidGgiLCAiQ3JlYXRlZCIsIFNvcnRPcmRlci5EZXNjZW5kaW5nKQ0KICAgICAgICAgICAgLkJ5KCJ0aCIsICJSb3dJRCIsIFNvcnRPcmRlci5Bc2NlbmRpbmcpDQogICAgICAgICAgICAuQnkoImZ2IiwgIk5hbWUiLCBTb3J0T3JkZXIuQXNjZW5kaW5nKQ0KICAgICAgICAgICAgLkJ5KCJmdiIsICJSb3dJRCIsIFNvcnRPcmRlci5Bc2NlbmRpbmcpOw0KDQogICAgICAgIGRiDQogICAgICAgICAgICAuU2V0Q29tbWFuZCgNCiAgICAgICAgICAgICAgICBidWlsZGVyLkJ1aWxkKCksDQogICAgICAgICAgICAgICAgZGIuUGFyYW1ldGVyKCJJRCIsIGNhcmRJRCkpDQogICAgICAgICAgICAuTG9nQ29tbWFuZCgpOw0KDQogICAgICAgIEtySGlzdG9yeUl0ZW0gcHJldkl0ZW0gPSBudWxsOw0KICAgICAgICB1c2luZyAodmFyIHJlYWRlciA9IGF3YWl0IGRiLkV4ZWN1dGVSZWFkZXJBc3luYygpKQ0KICAgICAgICB7DQogICAgICAgICAgICB3aGlsZSAoYXdhaXQgcmVhZGVyLlJlYWRBc3luYygpKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIEd1aWQgaXRlbVJvd0lEID0gcmVhZGVyLkdldEd1aWQoMCk7DQogICAgICAgICAgICAgICAgaWYgKHByZXZJdGVtICE9IG51bGwgJiYgcHJldkl0ZW0uUm93SUQgPT0gaXRlbVJvd0lEKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgLy8g0LTQvtCx0LDQstC70Y/QtdC8INGE0LDQudC70Ysg0Log0YLQsNGB0LrRgywg0L/RgNC40YfRkdC8INGF0L7RgtGPINCx0Ysg0L7QtNC40L0g0YTQsNC50Lsg0YPQttC1INC00L7QsdCw0LLQu9C10L0NCiAgICAgICAgICAgICAgICAgICAgR3VpZCBmaWxlSUQgPSByZWFkZXIuR2V0R3VpZCgxKTsNCiAgICAgICAgICAgICAgICAgICAgdmFyIGxhc3RJdGVtID0gcHJldkl0ZW0uRmlsZXNbcHJldkl0ZW0uRmlsZXMuQ291bnQgLSAxXTsNCiAgICAgICAgICAgICAgICAgICAgaWYgKGxhc3RJdGVtLkZpbGVJRCAhPSBmaWxlSUQpDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIC8vINC00LvRjyDQutCw0LbQtNC+0LPQviDRhNCw0LnQu9CwINC30LDQv9C40YHRi9Cy0LDQtdGC0YHRjyDRgtC+0LvRjNC60L4g0L7QtNC90LAg0LLQtdGA0YHQuNGPINC90LAg0YLQsNGB0LoNCiAgICAgICAgICAgICAgICAgICAgICAgIHByZXZJdGVtLkZpbGVzLkFkZChuZXcgS3JIaXN0b3J5RmlsZUl0ZW0NCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBGaWxlSUQgPSBmaWxlSUQsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgTW9kaWZpZWQgPSByZWFkZXIuR2V0RGF0ZVRpbWVVdGMoMiksDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgVmVyc2lvblJvd0lEID0gcmVhZGVyLkdldEd1aWQoMyksDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgRmlsZU5hbWUgPSByZWFkZXIuR2V0U3RyaW5nKDQpLA0KICAgICAgICAgICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAvLyDQutC+0LPQtNCwINGE0LDQudC7INGD0LbQtSDQsdGL0Lsg0LTQvtCx0LDQstC70LXQvSDQtNC70Y8g0YHRgtGA0L7QutC4INCyINC40YHRgtC+0YDQuNC4INC30LDQtNCw0L3QuNC5LCDRgtC+INC80Ysg0LTQvtC70LbQvdGLINCy0YvQsdGA0LDRgtGMINC/0L7RgdC70LXQtNC90Y7RjiDQstC10YDRgdC40Y4NCiAgICAgICAgICAgICAgICAgICAgICAgIERhdGVUaW1lIGNyZWF0ZWQgPSByZWFkZXIuR2V0RGF0ZVRpbWVVdGMoMik7DQoNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChsYXN0SXRlbS5Nb2RpZmllZCA8IGNyZWF0ZWQpDQogICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8g0Y3RgtCwINCy0LXRgNGB0LjRjyDQsdC+0LvQtdC1INC90L7QstCw0Y8sINGH0LXQvCDQv9GA0LXQtNGL0LTRg9GJ0LDRjywg0LfQsNC80LXQvdGP0LXQvCDQtdGRDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFzdEl0ZW0uTW9kaWZpZWQgPSBjcmVhdGVkOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhc3RJdGVtLlZlcnNpb25Sb3dJRCA9IHJlYWRlci5HZXRHdWlkKDMpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhc3RJdGVtLkZpbGVOYW1lID0gcmVhZGVyLkdldFN0cmluZyg0KTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBwcmV2SXRlbSA9IG5ldyBLckhpc3RvcnlJdGVtKCk7DQoNCiAgICAgICAgICAgICAgICAgICAgR3VpZD8gZmlsZUlEID0gcmVhZGVyLkdldFZhbHVlPEd1aWQ/PigxKTsNCiAgICAgICAgICAgICAgICAgICAgaWYgKGZpbGVJRC5IYXNWYWx1ZSkNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgLy8g0LTQvtCx0LDQstC70Y/QtdGC0YHRjyDQv9C10YDQstGL0Lkg0YTQsNC50LsNCiAgICAgICAgICAgICAgICAgICAgICAgIHByZXZJdGVtLkZpbGVzID0gbmV3IExpc3Q8S3JIaXN0b3J5RmlsZUl0ZW0+DQogICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3IEtySGlzdG9yeUZpbGVJdGVtDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBGaWxlSUQgPSBmaWxlSUQuVmFsdWUsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE1vZGlmaWVkID0gcmVhZGVyLkdldERhdGVUaW1lVXRjKDIpLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBWZXJzaW9uUm93SUQgPSByZWFkZXIuR2V0R3VpZCgzKSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRmlsZU5hbWUgPSByZWFkZXIuR2V0U3RyaW5nKDQpLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIH07DQogICAgICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgICAgICBwcmV2SXRlbS5Sb3dJRCA9IGl0ZW1Sb3dJRDsNCiAgICAgICAgICAgICAgICAgICAgcHJldkl0ZW0uQ3ljbGUgPSByZWFkZXIuR2V0VmFsdWU8c2hvcnQ+KDUpOw0KICAgICAgICAgICAgICAgICAgICBwcmV2SXRlbS5Db21wbGV0ZWRRdWFudHMgPSByZWFkZXIuR2V0VmFsdWU8aW50Pz4oNik7DQoNCiAgICAgICAgICAgICAgICAgICAgaXRlbXNbaXRlbVJvd0lEXSA9IHByZXZJdGVtOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIHJldHVybiBpdGVtczsNCn0NCiM+DQoNCjxodG1sPg0KICAgIDwhLS0gSHRtbCBUaXRsZSBiZWdpbiAtLT48dGl0bGU+eyRBcHByb3ZhbEhpc3RvcnlfSGVhZGVyfTwvdGl0bGU+PCEtLSBIdG1sIFRpdGxlIGVuZCAtLT4NCiAgICA8aGVhZD48bWV0YSBodHRwLWVxdWl2PUNvbnRlbnQtVHlwZSBjb250ZW50PSd0ZXh0L2h0bWw7IGNoYXJzZXQ9dXRmLTgnPjwvaGVhZD4NCg0KICAgIDwhLS0gQ3NzIERlZmF1bHQgYmVnaW4gLS0+DQogICAgPHN0eWxlPg0KICAgICAgICBib2R5DQogICAgICAgIHsNCiAgICAgICAgICAgIHBhZGRpbmctcmlnaHQ6IDBweDsNCiAgICAgICAgICAgIHBhZGRpbmctbGVmdDogMHB4Ow0KICAgICAgICAgICAgZm9udC1zaXplOiAxMXB4Ow0KICAgICAgICAgICAgYmFja2dyb3VuZDogI2ZmZjsNCiAgICAgICAgICAgIHBhZGRpbmctYm90dG9tOiAwcHg7DQogICAgICAgICAgICBtYXJnaW46IDBweDsNCiAgICAgICAgICAgIHBhZGRpbmctdG9wOiAwcHg7DQogICAgICAgICAgICBmb250LWZhbWlseTogdGFob21hLCB2ZXJkYW5hLCBhcmlhbCwgc2Fucy1zZXJpZjsNCiAgICAgICAgICAgIHRleHQtYWxpZ246IGxlZnQNCiAgICAgICAgfQ0KDQogICAgICAgIGRpdi5oMQ0KICAgICAgICB7DQogICAgICAgICAgICB0ZXh0LWFsaWduOiBjZW50ZXI7DQogICAgICAgICAgICBmb250LXdlaWdodDogYm9sZDsNCiAgICAgICAgICAgIGZvbnQtc2l6ZTogMS40ZW07DQogICAgICAgICAgICBwYWRkaW5nLXRvcDogNHB4Ow0KICAgICAgICAgICAgcGFkZGluZy1ib3R0b206IDRweDsNCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgZGl2LmgyDQogICAgICAgIHsNCiAgICAgICAgICAgIHRleHQtYWxpZ246IGNlbnRlcjsNCiAgICAgICAgICAgIGZvbnQtd2VpZ2h0OiBib2xkOw0KICAgICAgICAgICAgZm9udC1zaXplOiAxLjJlbTsNCiAgICAgICAgICAgIHBhZGRpbmctYm90dG9tOiA0cHg7DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIGRpdi5saW5rDQogICAgICAgIHsNCiAgICAgICAgICAgIHRleHQtYWxpZ246IHJpZ2h0Ow0KICAgICAgICAgICAgcGFkZGluZy1yaWdodDogMTBweDsNCiAgICAgICAgfQ0KDQogICAgICAgIGRpdi5ncm91cA0KICAgICAgICB7DQogICAgICAgICAgICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7DQogICAgICAgICAgICBmb250LXdlaWdodDogYm9sZDsNCiAgICAgICAgICAgIGZvbnQtc2l6ZTogMTFweDsNCiAgICAgICAgICAgIG1hcmdpbjogM3B4IDBweCA1cHg7DQogICAgICAgICAgICBvdmVyZmxvdzogaGlkZGVuOw0KICAgICAgICAgICAgY29sb3I6ICMzNjYzOGU7DQogICAgICAgICAgICBib3JkZXItYm90dG9tOiAjYjljNGRhIDFweCBzb2xpZA0KICAgICAgICB9DQogICAgICAgIGRpdi5ncm91cA0KICAgICAgICB7DQogICAgICAgICAgICBkaXNwbGF5OiBibG9jaw0KICAgICAgICB9DQogICAgICAgIGRpdi5ncm91cC1sYw0KICAgICAgICB7DQogICAgICAgICAgICBmbG9hdDogbGVmdA0KICAgICAgICB9DQogICAgICAgIGRpdi5ncm91cC1yYw0KICAgICAgICB7DQogICAgICAgICAgICBmbG9hdDogcmlnaHQNCiAgICAgICAgfQ0KDQogICAgICAgIGRpdi5ncm91cC1kYXRhDQogICAgICAgIHsNCiAgICAgICAgICAgIGRpc3BsYXk6IGlubGluZS1ibG9jazsNCiAgICAgICAgICAgIG1hcmdpbjogMTBweDsNCiAgICAgICAgICAgIG92ZXJmbG93OiBoaWRkZW47DQogICAgICAgIH0NCiAgICAgICAgZGl2Lmdyb3VwLWRhdGENCiAgICAgICAgew0KICAgICAgICAgICAgZGlzcGxheTogYmxvY2sNCiAgICAgICAgfQ0KDQogICAgICAgIC50YWJsZQ0KICAgICAgICB7DQogICAgICAgICAgICBwYWRkaW5nLXJpZ2h0OiAwcHg7DQogICAgICAgICAgICBwYWRkaW5nLWxlZnQ6IDBweDsNCiAgICAgICAgICAgIHBhZGRpbmctYm90dG9tOiAwcHg7DQogICAgICAgICAgICBwYWRkaW5nLXRvcDogMHB4Ow0KICAgICAgICAgICAgbWFyZ2luOiAwcHg7DQogICAgICAgICAgICB3aWR0aDogMTAwJTsNCiAgICAgICAgICAgIGJvcmRlci1jb2xsYXBzZTogY29sbGFwc2U7DQogICAgICAgICAgICBib3JkZXItdG9wOiAjYjljNGRhIDFweCBzb2xpZDsNCiAgICAgICAgICAgIGJvcmRlci1ib3R0b206ICNiOWM0ZGEgMXB4IHNvbGlkOw0KICAgICAgICAgICAgYm9yZGVyLXJpZ2h0OiAjYjljNGRhIDFweCBzb2xpZDsNCiAgICAgICAgICAgIGJvcmRlci1sZWZ0OiAjYjljNGRhIDFweCBzb2xpZDsNCiAgICAgICAgfQ0KICAgICAgICAudGFibGUgdGQNCiAgICAgICAgew0KICAgICAgICAgICAgZm9udC1zaXplOiAwLjdlbTsNCiAgICAgICAgICAgIHBhZGRpbmctcmlnaHQ6IDRweDsNCiAgICAgICAgICAgIHBhZGRpbmctbGVmdDogNHB4Ow0KICAgICAgICAgICAgcGFkZGluZy1ib3R0b206IDRweDsNCiAgICAgICAgICAgIHBhZGRpbmctdG9wOiA0cHg7DQogICAgICAgICAgICB2ZXJ0aWNhbC1hbGlnbjogdG9wOw0KICAgICAgICAgICAgdGV4dC1hbGlnbjogY2VudGVyOw0KICAgICAgICAgICAgYm9yZGVyLWJvdHRvbTogI2I5YzRkYSAxcHggc29saWQ7DQogICAgICAgICAgICBib3JkZXItcmlnaHQ6ICNiOWM0ZGEgMXB4IHNvbGlkOw0KICAgICAgICAgICAgYm9yZGVyLWxlZnQ6ICNiOWM0ZGEgMXB4IHNvbGlkOw0KICAgICAgICAgICAgYm9yZGVyLXRvcDogI2I5YzRkYSAxcHggc29saWQ7DQogICAgICAgIH0NCiAgICAgICAgLnRhYmxlIHRoDQogICAgICAgIHsNCiAgICAgICAgICAgIGZvbnQtd2VpZ2h0OiBib2xkOw0KICAgICAgICAgICAgZm9udC1zaXplOiAwLjdlbTsNCiAgICAgICAgICAgIHBhZGRpbmctcmlnaHQ6IDRweDsNCiAgICAgICAgICAgIHBhZGRpbmctbGVmdDogNHB4Ow0KICAgICAgICAgICAgcGFkZGluZy1ib3R0b206IDRweDsNCiAgICAgICAgICAgIHBhZGRpbmctdG9wOiA0cHg7DQogICAgICAgICAgICB2ZXJ0aWNhbC1hbGlnbjogdG9wOw0KICAgICAgICAgICAgdGV4dC1hbGlnbjogY2VudGVyOw0KICAgICAgICAgICAgYm9yZGVyLWJvdHRvbTogI2I5YzRkYSAxcHggc29saWQ7DQogICAgICAgICAgICBib3JkZXItcmlnaHQ6ICNiOWM0ZGEgMXB4IHNvbGlkOw0KICAgICAgICAgICAgYm9yZGVyLWxlZnQ6ICNiOWM0ZGEgMXB4IHNvbGlkOw0KICAgICAgICAgICAgYm9yZGVyLXRvcDogI2I5YzRkYSAxcHggc29saWQ7DQogICAgICAgIH0NCiAgICA8L3N0eWxlPg0KICAgIDwhLS0gQ3NzIERlZmF1bHQgZW5kIC0tPg0KICAgIDwhLS0gQ3NzIGJlZ2luLS0+PCEtLSBDc3MgZW5kLS0+DQoNCiAgICA8Ym9keT4NCiAgICAgICAgPCEtLSBUb3AgYmVnaW4gLS0+PCEtLSBUb3AgZW5kIC0tPg0KICAgICAgICA8ZGl2IGNsYXNzPSdoMSc+PCEtLSBUaXRsZSBiZWdpbiAtLT57JEFwcHJvdmFsSGlzdG9yeV9IZWFkZXJ9PCEtLSBUaXRsZSBlbmQgLS0+PC9kaXY+DQogICAgICAgIDxkaXYgY2xhc3M9J2gyJz48IS0tIEhlYWRlciBiZWdpbiAtLT48Iw0KDQogICAgICAgIC8vINCg0LDRgdGH0LXRgiDQv9Cw0YDQsNC80LXRgtGA0L7QsiDQt9Cw0LPQvtC70L7QstC60LANCiAgICAgICAgdmFyIGZ1bGxOdW1iZXIgPSBhd2FpdCBjb250ZXh0LkdldFZhbHVlRnJvbVBsYWNlaG9sZGVyQXN5bmM8c3RyaW5nPigiZjpEb2N1bWVudENvbW1vbkluZm8uRnVsbE51bWJlciIpOw0KICAgICAgICB2YXIgY3JlYXRpb25EYXRlID0gYXdhaXQgY29udGV4dC5HZXRWYWx1ZUZyb21QbGFjZWhvbGRlckFzeW5jPERhdGVUaW1lPz4oImY6RG9jdW1lbnRDb21tb25JbmZvLkNyZWF0aW9uRGF0ZSIpOw0KICAgICAgICB2YXIgc3ViamVjdCA9IGF3YWl0IGNvbnRleHQuR2V0VmFsdWVGcm9tUGxhY2Vob2xkZXJBc3luYzxzdHJpbmc+KCJmOkRvY3VtZW50Q29tbW9uSW5mby5TdWJqZWN0Iik7DQogICAgICAgIHZhciB0eXBlQ2FwdGlvbiA9IGF3YWl0IGNvbnRleHQuR2V0VmFsdWVGcm9tUGxhY2Vob2xkZXJBc3luYzxzdHJpbmc+KCJmOkRvY3VtZW50Q29tbW9uSW5mby5Eb2NUeXBlVGl0bGUiKSA/PyBhd2FpdCBjb250ZXh0LkdldFZhbHVlRnJvbVBsYWNlaG9sZGVyQXN5bmM8c3RyaW5nPigiZjpJbnN0YW5jZXMuVHlwZUlELT5UeXBlcy5DYXB0aW9uIik7ICAgICAgIA0KICAgICAgICANCiAgICAgICAgaWYgKCFzdHJpbmcuSXNOdWxsT3JFbXB0eShmdWxsTnVtYmVyKSkNCiAgICAgICAgew0KICAgICAgICAgICAgaWYgKGNyZWF0aW9uRGF0ZS5IYXNWYWx1ZSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICB0ZXh0QnVpbGRlci5BcHBlbmQoDQogICAgICAgICAgICAgICAgICAgIExvY2FsaXphdGlvbk1hbmFnZXIuRm9ybWF0KA0KICAgICAgICAgICAgICAgICAgICAgICAgIiRBcHByb3ZhbEhpc3RvcnlfRG9jdW1lbnRUaXRsZVdpdGhEYXRlIiwgDQogICAgICAgICAgICAgICAgICAgICAgICB0eXBlQ2FwdGlvbiwgDQogICAgICAgICAgICAgICAgICAgICAgICBmdWxsTnVtYmVyLCANCiAgICAgICAgICAgICAgICAgICAgICAgIEZvcm1hdHRpbmdIZWxwZXIuRm9ybWF0RGF0ZShjcmVhdGlvbkRhdGUuVmFsdWUsIGNvbnZlcnRUb0xvY2FsOiBmYWxzZSkpKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICB0ZXh0QnVpbGRlci5BcHBlbmQoDQogICAgICAgICAgICAgICAgICAgIExvY2FsaXphdGlvbk1hbmFnZXIuRm9ybWF0KA0KICAgICAgICAgICAgICAgICAgICAgICAgIiRBcHByb3ZhbEhpc3RvcnlfRG9jdW1lbnRUaXRsZU5vRGF0ZSIsIA0KICAgICAgICAgICAgICAgICAgICAgICAgdHlwZUNhcHRpb24sIA0KICAgICAgICAgICAgICAgICAgICAgICAgZnVsbE51bWJlcikpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgaWYgKCFzdHJpbmcuSXNOdWxsT3JFbXB0eShzdWJqZWN0KSkNCiAgICAgICAgew0KICAgICAgICAgICAgaWYgKCFzdHJpbmcuSXNOdWxsT3JFbXB0eShmdWxsTnVtYmVyKSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICB0ZXh0QnVpbGRlci5BcHBlbmQoIjxici8+Iik7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHRleHRCdWlsZGVyLkFwcGVuZCgiJmx0O3tmOkRvY3VtZW50Q29tbW9uSW5mby5TdWJqZWN0fSZndDsiKTsNCiAgICAgICAgfSAjPg0KICAgICAgICA8IS0tIEhlYWRlciBlbmQgLS0+PC9kaXY+DQogICAgICAgIA0KICAgICAgICA8Iw0KICAgICAgICAvLyDQlNC+0LHQsNCy0LvQtdC90LjQtSDRgdGB0YvQu9C60Lgg0L3QsCDQutCw0YDRgtC+0YfQutGDINC4INC/0LXRh9Cw0YLQvdGD0Y4g0YTQvtGA0LzRgyDRhNCw0LnQu9CwLCDQtdGB0LvQuCDQvtC90Lgg0L3Rg9C20L3Riw0KICAgICAgICBpZiAoIWlzUHJpbnRhYmxlDQogICAgICAgICAgICAmJiAoIXdlYkNsaWVudCB8fCAhc3RyaW5nLklzTnVsbE9yV2hpdGVTcGFjZSh3ZWJBZGRyZXNzKSkpDQogICAgICAgIHsgIz4NCiAgICAgICAgPGRpdiBjbGFzcz0nbGluayc+PCEtLSBDYXJkIExpbmsgYmVnaW4gLS0+DQogICAgICAgICAgICA8Iw0KICAgICAgICAgICAgaWYgKHdlYkNsaWVudCkNCiAgICAgICAgICAgIHsgDQogICAgICAgICAgICAgICAgdmFyIGxpbmtUZXh0ID0gQ2FyZEhlbHBlci5HZXRXZWJGaWxlTGluaygNCiAgICAgICAgICAgICAgICAgICAgd2ViQWRkcmVzcywNCiAgICAgICAgICAgICAgICAgICAgYXdhaXQgY29udGV4dC5HZXRDYXJkSURBc3luYygpLA0KICAgICAgICAgICAgICAgICAgICB2aXJ0dWFsRmlsZUlELA0KICAgICAgICAgICAgICAgICAgICBwcmludGFibGVWZXJzaW9uSUQsDQogICAgICAgICAgICAgICAgICAgIGZpbGVOYW1lOiBMb2NhbGl6YXRpb25NYW5hZ2VyLkxvY2FsaXplKCIkQXBwcm92YWxIaXN0b3J5X0ZpbGVOYW1lX1ByaW50YWJsZSIpLA0KICAgICAgICAgICAgICAgICAgICBmaWxlVHlwZU5hbWU6IERlZmF1bHRGaWxlVHlwZXMuS3JWaXJ0dWFsRmlsZSwNCiAgICAgICAgICAgICAgICAgICAgYXNIdG1sOiB0cnVlKTsNCiAgICAgICAgICAgICM+DQogICAgICAgICAgICANCiAgICAgICAgICAgIDxhIHRhcmdldD0iX2JsYW5rIiByZWw9Im5vb3BlbmVyIG5vcmVmZXJyZXIiIGhyZWY9IjwjPSBsaW5rVGV4dCAjPiI+eyRBcHByb3ZhbEhpc3RvcnlfUHJpbnRhYmxlVmVyc2lvbn08L2E+Jm5ic3A7Jm5ic3A7Jm5ic3A7DQogICAgICAgICAgICA8YSB0YXJnZXQ9Il9ibGFuayIgcmVsPSJub29wZW5lciBub3JlZmVycmVyIiBocmVmPSI8Iz0gQ2FyZEhlbHBlci5HZXRXZWJMaW5rKHdlYkFkZHJlc3MsIGF3YWl0IGNvbnRleHQuR2V0Q2FyZElEQXN5bmMoKSkgIz4iPnskQXBwcm92YWxIaXN0b3J5X09wZW5DYXJkfTwvYT4NCiAgICAgICAgICAgIDwjDQogICAgICAgICAgICB9IGVsc2UgeyAjPg0KICAgICAgICAgICAgDQogICAgICAgICAgICA8YSBocmVmPSI8Iz0gQ2FyZEhlbHBlci5HZXRMaW5rKA0KICAgICAgICAgICAgICAgICAgICBjb250ZXh0LlNlc3Npb24sDQogICAgICAgICAgICAgICAgICAgIGF3YWl0IGNvbnRleHQuR2V0Q2FyZElEQXN5bmMoKSwNCiAgICAgICAgICAgICAgICAgICAgdmlydHVhbEZpbGVJRCwNCiAgICAgICAgICAgICAgICAgICAgcHJpbnRhYmxlVmVyc2lvbklEKSAjPiI+eyRBcHByb3ZhbEhpc3RvcnlfUHJpbnRhYmxlVmVyc2lvbn08L2E+Jm5ic3A7Jm5ic3A7Jm5ic3A7DQogICAgICAgICAgICA8YSBocmVmPSI8Iz0gQ2FyZEhlbHBlci5HZXRMaW5rKGNvbnRleHQuU2Vzc2lvbiwgYXdhaXQgY29udGV4dC5HZXRDYXJkSURBc3luYygpKSAjPiI+eyRBcHByb3ZhbEhpc3RvcnlfT3BlbkNhcmR9PC9hPg0KICAgICAgICA8IS0tIENhcmQgTGluayBlbmQgLS0+PC9kaXY+IDwjDQogICAgICAgIH19DQoNCiAgICAgICAgaWYgKCFpc1ByaW50YWJsZSkNCiAgICAgICAgeyAgICAgICANCiAgICAgICAgICAgIHZhciB0YXNrSXRlbXMgPSBhd2FpdCBHZXRBcHByb3ZhbFRhc2tJdGVtc0FzeW5jKGNvbnRleHQuRGJTY29wZSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGlmICh0YXNrSXRlbXMuQ291bnQgPiAwKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGNvbnRleHQuSW5mb1siVGFza0l0ZW1zIl0gPSB0YXNrSXRlbXM7DQogICAgICAgICAgICAgICAgY29udGV4dC5JbmZvWyJUYXNrSXRlbXNDb3VudGVyIl0gPSB0YXNrSXRlbXMuQ291bnQ7DQogICAgICAgICM+DQogICAgICAgIDwhLS0gVGFza3MgYmVnaW4gLS0+DQogICAgICAgIDxkaXYgY2xhc3M9J2dyb3VwJz4NCiAgICAgICAgICAgIDxkaXYgY2xhc3M9J2dyb3VwLWxjJz4NCiAgICAgICAgICAgICAgICAmbmJzcDt7JEFwcHJvdmFsSGlzdG9yeV9BY3RpdmVUYXNrc30NCiAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICA8L2Rpdj4NCiAgICAgICAgPGRpdiBjbGFzcz0nZ3JvdXAtZGF0YSc+DQogICAgICAgICAgICA8dGFibGUgY2VsbHBhZGRpbmc9JzAnIGNlbGxzcGFjaW5nPScwJyBjbGFzcz0ndGFibGUnPg0KICAgICAgICAgICAgICAgIDx0cj4NCiAgICAgICAgICAgICAgICAgICAgPHRoIHdpZHRoPSczJSc+PC90aD4NCiAgICAgICAgICAgICAgICAgICAgPHRoIHdpZHRoPScxOCUnPnskQXBwcm92YWxIaXN0b3J5X1JvbGV9PC90aD4NCiAgICAgICAgICAgICAgICAgICAgPHRoIHdpZHRoPScxOCUnPnskQXBwcm92YWxIaXN0b3J5X0N1cnJlbnRQZXJmb3JtZXJ9PC90aD4NCiAgICAgICAgICAgICAgICAgICAgPHRoIHdpZHRoPScyMiUnPnskQXBwcm92YWxIaXN0b3J5X0luUHJvZ3Jlc3NGcm9tfTwvdGg+DQogICAgICAgICAgICAgICAgICAgIDx0aCB3aWR0aD0nMjIlJz57JEFwcHJvdmFsSGlzdG9yeV9DcmVhdGVkQXR9PC90aD4NCiAgICAgICAgICAgICAgICAgICAgPHRoIHdpZHRoPScxNyUnPnskQXBwcm92YWxIaXN0b3J5X1RpbWVMZWZ0fTwvdGg+DQogICAgICAgICAgICAgICAgPC90cj4NCiAgICAgICAgICAgICAgICA8X3Jvdz4NCiAgICAgICAgICAgICAgICA8dHI+DQogICAgICAgICAgICAgICAgICAgIDwjIz0gLy8g0JjQvdC40YbQuNCw0LvQuNC30LDRhtC40Y8g0YLQsNCx0LvQuNGG0Ysg0L4g0LfQsNC00LDQvdC40Y/RhS4g0JfQtNC10YHRjCDQvNC+0LbQvdC+INC/0L7QvNC10L3Rj9GC0Ywg0YHQvtGA0YLQuNGA0L7QstC60YMg0LLRi9Cy0L7QtNCwINC30LDQtNCw0L3QuNC5DQogICAgICAgICAgICAgICAgICAgICJ7dDpUYXNrcy5Sb3dJRC0oVGFza0lEKS0+S3JBY3RpdmVUYXNrcy5UYXNrSUQgb3JkZXIgYnkgIiArIA0KICAgICAgICAgICAgICAgICAgICAiVGFza3MuQ3JlYXRlZCAiICsgKGNvbnRleHQuSW5mby5HZXQ8Ym9vbD4oIkFzY2VuZGluZ09yZGVyIikgPyAiYXNjIiA6ICJkZXNjIikgKyANCiAgICAgICAgICAgICAgICAgICAgIn0iIA0KICAgICAgICAgICAgICAgICAgICAjIz4NCiAgICAgICAgICAgICAgICAgICAgPCMgLy8g0JXRgdC70Lgg0LTQu9GPINC00LDQvdC90L7Qs9C+INC30LDQtNCw0L3QuNGPINC90LXRgiDQtNC+0L/QvtC70L3QuNGC0LXQu9GM0L3QvtC5INC40L3RhNC+0YDQvNCw0YbQuNC4INC+INC30LDQtNCw0L3QuNC4LCDQtNCw0L3QvdGD0Y4g0YHRgtGA0L7QutGDINC90LUg0LLRi9Cy0L7QtNC40LwNCiAgICAgICAgICAgICAgICAgICAgaWYgKCFjb250ZXh0LkluZm8uR2V0PERpY3Rpb25hcnk8R3VpZCwgKGludD8sIGludD8sIGludD8pPj4oIlRhc2tJdGVtcyIpLlRyeUdldFZhbHVlKGF3YWl0IGNvbnRleHQuR2V0VmFsdWVGcm9tUGxhY2Vob2xkZXJBc3luYzxHdWlkPigidDpUYXNrcy5Sb3dJRCIpLCBvdXQgdmFyIGl0ZW0pKQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gc3RyaW5nLkVtcHR5Ow0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICM+DQogICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICA8dGQgd2lkdGg9JzMlJz48IyAvLyDQktGL0LLQvtC0INC90L7QvNC10YDQsCDQt9Cw0LTQsNC90LjRjy4g0JzQvtC20LXRgiDQsdGL0YLRjCDQvtCx0YDQsNGC0L3Ri9C8DQogICAgICAgICAgICAgICAgICAgIGlmIChjb250ZXh0LkluZm8uR2V0PGJvb2w+KCJBc2NlbmRpbmdPcmRlciIpKSANCiAgICAgICAgICAgICAgICAgICAgeyANCiAgICAgICAgICAgICAgICAgICAgICAgIHRleHRCdWlsZGVyLkFwcGVuZCgie259Iik7IA0KICAgICAgICAgICAgICAgICAgICB9IA0KICAgICAgICAgICAgICAgICAgICBlbHNlIA0KICAgICAgICAgICAgICAgICAgICB7IA0KICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNudCA9IGNvbnRleHQuSW5mby5HZXQ8aW50PigiVGFza0l0ZW1zQ291bnRlciIpOyANCiAgICAgICAgICAgICAgICAgICAgICAgIHRleHRCdWlsZGVyLkFwcGVuZChjbnQpOyANCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRleHQuSW5mb1siVGFza0l0ZW1zQ291bnRlciJdID0gY250IC0gMTsgDQogICAgICAgICAgICAgICAgICAgIH0gIz48L3RkPg0KICAgICAgICAgICAgICAgICAgICA8dGQgd2lkdGg9JzE4JSc+e3Q6VGFza3MuUm9sZU5hbWV9PC90ZD4NCiAgICAgICAgICAgICAgICAgICAgPHRkIHdpZHRoPScxOCUnPnt0OlRhc2tzLlVzZXJOYW1lfTwvdGQ+DQogICAgICAgICAgICAgICAgICAgIDx0ZCB3aWR0aD0nMjIlJz57dDpUYXNrcy5JblByb2dyZXNzOmRkLk1NLnl5eXkgSEhcOm1tfQ0KICAgICAgICAgICAgICAgICAgICA8Iw0KICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbS5JdGVtMi5IYXNWYWx1ZSkNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgdGV4dEJ1aWxkZXIuQXBwZW5kRm9ybWF0KCIgKHswfSkiLCAoaXRlbS5JdGVtMi5WYWx1ZSA8IDAgPyAieyRGb3JtYXRfRGF0ZURpZmZfT3ZlcmR1ZX0mbmJzcDsiIDogbnVsbCkgKyBGb3JtYXR0aW5nSGVscGVyLkZvcm1hdERhdGVEaWZmKGl0ZW0uSXRlbTIuVmFsdWUpLlJlcGxhY2UoIiAiLCAiJm5ic3A7IikpOw0KICAgICAgICAgICAgICAgICAgICB9ICM+PC90ZD4NCiAgICAgICAgICAgICAgICAgICAgPHRkIHdpZHRoPScyMiUnPnt0OlRhc2tzLkNyZWF0ZWQ6ZGQuTU0ueXl5eSBISFw6bW19DQogICAgICAgICAgICAgICAgICAgIDwjDQogICAgICAgICAgICAgICAgICAgIGlmIChpdGVtLkl0ZW0xLkhhc1ZhbHVlKQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICB0ZXh0QnVpbGRlci5BcHBlbmRGb3JtYXQoIiAoezB9KSIsIChpdGVtLkl0ZW0xLlZhbHVlIDwgMCA/ICJ7JEZvcm1hdF9EYXRlRGlmZl9PdmVyZHVlfSZuYnNwOyIgOiBudWxsKSArIEZvcm1hdHRpbmdIZWxwZXIuRm9ybWF0RGF0ZURpZmYoaXRlbS5JdGVtMS5WYWx1ZSkuUmVwbGFjZSgiICIsICImbmJzcDsiKSk7DQogICAgICAgICAgICAgICAgICAgIH0gIz48L3RkPg0KICAgICAgICAgICAgICAgICAgICA8dGQgd2lkdGg9JzE3JSc8Iw0KICAgICAgICAgICAgICAgICAgICB0ZXh0QnVpbGRlci5BcHBlbmQoaXRlbS5JdGVtMyA8IDAgPyAic3R5bGU9J2NvbG9yOiNjYzAwMDAnPiIgOiAiPiIpOw0KICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgaWYgKGl0ZW0uSXRlbTMuSGFzVmFsdWUpDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHRleHRCdWlsZGVyLkFwcGVuZCgoaXRlbS5JdGVtMy5WYWx1ZSA8IDAgPyAieyRGb3JtYXRfRGF0ZURpZmZfT3ZlcmR1ZX0mbmJzcDsiIDogbnVsbCkgKyBGb3JtYXR0aW5nSGVscGVyLkZvcm1hdERhdGVEaWZmKGl0ZW0uSXRlbTMuVmFsdWUpLlJlcGxhY2UoIiAiLCAiJm5ic3A7IikpOw0KICAgICAgICAgICAgICAgICAgICB9ICM+PC90ZD4NCiAgICAgICAgICAgICAgICA8L3RyPg0KICAgICAgICAgICAgICAgIDwvX3Jvdz4NCiAgICAgICAgICAgIDwvdGFibGU+DQogICAgICAgIDwvZGl2Pg0KICAgICAgICA8IS0tIFRhc2tzIGVuZCAtLT4NCiAgICAgICAgPCMgIH0gLy8gdGFza0l0ZW1zLkNvdW50ID4gMA0KICAgICAgICB9IC8vICFpc1ByaW50YWJsZSAjPiAgICANCiAgICAgICAgDQogICAgICAgIDwjDQogICAgICAgIHZhciBoaXN0b3J5SXRlbXMgPSBhd2FpdCBHZXRBcHByb3ZhbEhpc3RvcnlJdGVtc0FzeW5jKGNvbnRleHQuRGJTY29wZSk7DQogICAgICAgIGlmIChoaXN0b3J5SXRlbXMuQ291bnQgPiAwKQ0KICAgICAgICB7DQogICAgICAgICAgICBjb250ZXh0LkluZm9bIkhpc3RvcnlJdGVtcyJdID0gaGlzdG9yeUl0ZW1zOw0KICAgICAgICAjPg0KICAgICAgICA8IS0tIFRhc2sgSGlzdG9yeSBiZWdpbiAtLT4NCiAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICA8X2dyb3VwPg0KICAgICAgICA8IyMgDQogICAgICAgICAgICB2YXIgYXNjZW5kaW5nT3JkZXIgPSBjb250ZXh0LkluZm8uR2V0PGJvb2w+KCJBc2NlbmRpbmdPcmRlciIpOw0KICAgICAgICAgICAgdGV4dEJ1aWxkZXIuQXBwZW5kKCJ7dDpUYXNrSGlzdG9yeS5Sb3dJRC0oSGlzdG9yeVJlY29yZCktPktyQXBwcm92YWxIaXN0b3J5LkN5Y2xlIiArDQogICAgICAgICAgICAgICAgIiBvcmRlciBieSBLckFwcHJvdmFsSGlzdG9yeS5DeWNsZSAiICsgKGFzY2VuZGluZ09yZGVyID8gImFzYyIgOiAiZGVzYyIpICsNCiAgICAgICAgICAgICAgICAiLCBUYXNrSGlzdG9yeS5Db21wbGV0ZWQgIiArIChhc2NlbmRpbmdPcmRlciA/ICJhc2MiIDogImRlc2MiKSArDQogICAgICAgICAgICAgICAgIiwgVGFza0hpc3RvcnkuQ3JlYXRlZCAiICsgKGFzY2VuZGluZ09yZGVyID8gImFzYyIgOiAiZGVzYyIpICsNCiAgICAgICAgICAgICAgICAiLCBUYXNrSGlzdG9yeS5Sb3dJRCAiICsgKGFzY2VuZGluZ09yZGVyID8gImRlc2MiIDogImFzYyIpICsNCiAgICAgICAgICAgICAgICAifSIpOyAgICAgICAgICAgDQogICAgICAgICMjPg0KICAgICAgICA8Iw0KICAgICAgICAgICAgaWYgKGNvbnRleHQuR3JvdXBCeS5GaWVsZHMuQ291bnQgPT0gMCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gc3RyaW5nLkVtcHR5Ow0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgDQogICAgICAgICAgICB2YXIgYXNjZW5kaW5nT3JkZXIgPSBjb250ZXh0LkluZm8uR2V0PGJvb2w+KCJBc2NlbmRpbmdPcmRlciIpOw0KICAgICAgICAgICAgdmFyIGhpc3RvcnlJdGVtcyA9IGNvbnRleHQuSW5mby5HZXQ8RGljdGlvbmFyeTxHdWlkLCBLckhpc3RvcnlJdGVtPj4oIkhpc3RvcnlJdGVtcyIpOw0KICAgICAgICAgICAgdmFyIGN1cnJlbnRDeWNsZSA9IChzaG9ydCljb250ZXh0Lkdyb3VwQnkuRmllbGRzWzBdLlZhbHVlOw0KICAgICAgICAgICAgdmFyIGl0ZW1zQ291bnQgPSBoaXN0b3J5SXRlbXMuVmFsdWVzLkNvdW50KHAgPT4gcC5DeWNsZSA9PSBjdXJyZW50Q3ljbGUpOw0KICAgICAgICAgICAgaWYgKGFzY2VuZGluZ09yZGVyKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGNvbnRleHQuSW5mb1siSGlzdG9yeUl0ZW1zQ291bnRlciJdID0gMTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBjb250ZXh0LkluZm9bIkhpc3RvcnlJdGVtc0NvdW50ZXIiXSA9IGl0ZW1zQ291bnQ7DQogICAgICAgICAgICB9DQogICAgICAgICAgICANCiAgICAgICAgICAgIGlmIChpdGVtc0NvdW50ID09IDApDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgcmV0dXJuIHN0cmluZy5FbXB0eTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgIz4NCiAgICAgICAgPCEtLSBDeWNsZSBUaXRsZSBiZWdpbiAtLT4NCiAgICAgICAgPCMgaWYgKCFjb250ZXh0LkluZm8uR2V0PGJvb2w+KCJJc1ByaW50YWJsZSIpICYmIGN1cnJlbnRDeWNsZSA+IDApIHsgIz4gICAgIA0KICAgICAgICA8ZGl2IGNsYXNzPSdncm91cCc+DQogICAgICAgICAgICA8ZGl2IGNsYXNzPSdncm91cC1sYyc+DQogICAgICAgICAgICAgICAgJm5ic3A7eyRBcHByb3ZhbEhpc3RvcnlfQXBwcm92YWxDeWNsZX0ge3Q6VGFza0hpc3RvcnkuUm93SUQtKEhpc3RvcnlSZWNvcmQpLT5LckFwcHJvdmFsSGlzdG9yeS5DeWNsZX0NCiAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICA8L2Rpdj4NCiAgICAgICAgPCMgfSAjPg0KICAgICAgICA8IS0tIEN5Y2xlIFRpdGxlIGVuZCAtLT4NCiAgICAgICAgDQogICAgICAgIDwhLS0gQ3ljbGUgQm9keSBiZWdpbiAtLT4NCiAgICAgICAgPGRpdiBjbGFzcz0nZ3JvdXAtZGF0YSc+DQogICAgICAgICAgICA8dGFibGUgY2VsbHBhZGRpbmc9JzAnIGNlbGxzcGFjaW5nPScwJyBjbGFzcz0ndGFibGUnPg0KICAgICAgICAgICAgICAgIDx0cj4NCiAgICAgICAgICAgICAgICAgICAgPHRoIHdpZHRoPSczJSc+PC90aD4NCiAgICAgICAgICAgICAgICAgICAgPHRoIHdpZHRoPScxNSUnPnskQXBwcm92YWxIaXN0b3J5X0VtcGxveWVlfTwvdGg+DQogICAgICAgICAgICAgICAgICAgIDx0aCB3aWR0aD0nMTUlJz57JEFwcHJvdmFsSGlzdG9yeV9Sb2xlfTwvdGg+DQogICAgICAgICAgICAgICAgICAgIDx0aCB3aWR0aD0nMTAlJz57JEFwcHJvdmFsSGlzdG9yeV9EZWNpc2lvbn08L3RoPg0KICAgICAgICAgICAgICAgICA8IyBpZiAoIWNvbnRleHQuSW5mby5HZXQ8Ym9vbD4oIklzUHJpbnRhYmxlIikpDQogICAgICAgICAgICAgICAgICAgIHsgIz4NCiAgICAgICAgICAgICAgICAgICAgPHRoIHdpZHRoPScxMCUnPnskQXBwcm92YWxIaXN0b3J5X1JlY2VpdmVkfTwvdGg+DQogICAgICAgICAgICAgICAgIDwjIH0gIz4NCiAgICAgICAgICAgICAgICAgICAgPCEtLSBDb21wbGV0ZWQgQ29sdW1uIGJlZ2luIC0tPg0KICAgICAgICAgICAgICAgICAgICA8dGggd2lkdGg9JzEwJSc+eyRBcHByb3ZhbEhpc3RvcnlfQ29tcGxldGVkQXR9PC90aD4NCiAgICAgICAgICAgICAgICAgICAgPCEtLSBDb21wbGV0ZWQgQ29sdW1uIGVuZCAtLT4NCiAgICAgICAgICAgICAgICAgICAgPHRoIHdpZHRoPSc8Iz0gY29udGV4dC5JbmZvLkdldDxzdHJpbmc+KCJSZXN1bHRQZXJjZW50IikgIz4lJz57JEFwcHJvdmFsSGlzdG9yeV9Db21tZW50fTwvdGg+DQogICAgICAgICAgICAgICAgPC90cj4NCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICA8X3Jvdz4NCiAgICAgICAgICAgICAgICA8Iw0KICAgICAgICAgICAgICAgIGlmICghY29udGV4dC5JbmZvLkdldDxEaWN0aW9uYXJ5PEd1aWQsIEtySGlzdG9yeUl0ZW0+PigiSGlzdG9yeUl0ZW1zIikuVHJ5R2V0VmFsdWUoYXdhaXQgY29udGV4dC5HZXRWYWx1ZUZyb21QbGFjZWhvbGRlckFzeW5jPEd1aWQ+KCJ0OlRhc2tIaXN0b3J5LlJvd0lEIiksIG91dCB2YXIgaXRlbSkpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gc3RyaW5nLkVtcHR5Ow0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB2YXIgYXNjZW5kaW5nT3JkZXIgPSBjb250ZXh0LkluZm8uR2V0PGJvb2w+KCJBc2NlbmRpbmdPcmRlciIpOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICM+DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgPHRyPg0KICAgICAgICAgICAgICAgICAgICA8dGQgd2lkdGg9JzMlJz48IyAvLyDQoNCw0YHRh9C10YIg0L3QvtC80LXRgNCwINGB0YLRgNC+0LrQuCDQv9GA0L7QuNC30LLQvtC00LjRgtGB0Y8g0LLRgdC10LPQtNCwINGB0LrRgNC40L/RgtC+0Lwg0YHQviDRgdGH0LXRgtGH0LjQutC+0Lwg0LTQu9GPINC60LDQttC00L7QuSDQs9GA0YPQv9C/0YsNCiAgICAgICAgICAgICAgICAgICAgdmFyIGNudCA9IGNvbnRleHQuSW5mby5HZXQ8aW50PigiSGlzdG9yeUl0ZW1zQ291bnRlciIpOyANCiAgICAgICAgICAgICAgICAgICAgdGV4dEJ1aWxkZXIuQXBwZW5kKGNudCk7IA0KICAgICAgICAgICAgICAgICAgICBpZiAoYXNjZW5kaW5nT3JkZXIpIHsgY29udGV4dC5JbmZvWyJIaXN0b3J5SXRlbXNDb3VudGVyIl0gPSBjbnQgKyAxOyB9IGVsc2UgeyBjb250ZXh0LkluZm9bIkhpc3RvcnlJdGVtc0NvdW50ZXIiXSA9IGNudCAtIDE7IH0gIz48L3RkPg0KICAgICAgICAgICAgICAgICAgICA8dGQgd2lkdGg9JzE1JSc+e3Q6VGFza0hpc3RvcnkuVXNlck5hbWV9PC90ZD4NCiAgICAgICAgICAgICAgICAgICAgPHRkIHdpZHRoPScxNSUnPjwjDQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoYXdhaXQgY29udGV4dC5HZXRWYWx1ZUZyb21QbGFjZWhvbGRlckFzeW5jPEd1aWQ+KCJ0OlRhc2tIaXN0b3J5LlR5cGVJRCIpID09IERlZmF1bHRUYXNrVHlwZXMuS3JBZGRpdGlvbmFsQXBwcm92YWxUeXBlSUQpIHsgIz4NCiAgICAgICAgICAgICAgICAgICAgICAgIDxiPnskQXBwcm92YWxIaXN0b3J5X0FkZGl0aW9uYWxBcHByb3ZhbH08L2I+PC9icj48Iw0KICAgICAgICAgICAgICAgICAgICAgICAgfSANCiAgICAgICAgICAgICAgICAgICAgICAgIGJvb2wgaGFzUm9sZU5hbWUgPSBmYWxzZTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghc3RyaW5nLklzTnVsbE9yRW1wdHkoYXdhaXQgY29udGV4dC5HZXRWYWx1ZUZyb21QbGFjZWhvbGRlckFzeW5jPHN0cmluZz4oInQ6VGFza0hpc3RvcnkuVXNlclBvc2l0aW9uIikpKQ0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhhc1JvbGVOYW1lID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZXh0QnVpbGRlci5BcHBlbmQoInt0OlRhc2tIaXN0b3J5LlVzZXJQb3NpdGlvbn0iKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0gDQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXN0cmluZy5Jc051bGxPckVtcHR5KGF3YWl0IGNvbnRleHQuR2V0VmFsdWVGcm9tUGxhY2Vob2xkZXJBc3luYzxzdHJpbmc+KCJ0OlRhc2tIaXN0b3J5LlVzZXJQb3NpdGlvbiIpKSkNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaGFzUm9sZU5hbWUpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZXh0QnVpbGRlci5BcHBlbmQoIjwvYnI+Iik7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhhc1JvbGVOYW1lID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZXh0QnVpbGRlci5BcHBlbmQoInt0OlRhc2tIaXN0b3J5LlVzZXJQb3NpdGlvbn0iKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0gDQogICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghaGFzUm9sZU5hbWUpDQogICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGV4dEJ1aWxkZXIuQXBwZW5kKCJ7dDpUYXNrSGlzdG9yeS5Sb2xlTmFtZX0iKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0gICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgIz4NCiAgICAgICAgICAgICAgICAgICAgPC90ZD4NCiAgICAgICAgICAgICAgICAgICAgPHRkIHdpZHRoPScxMCUnPnt0OlRhc2tIaXN0b3J5Lk9wdGlvbkNhcHRpb259PC90ZD48Iw0KICAgICAgICAgICAgICAgICAgICBpZiAoIWNvbnRleHQuSW5mby5HZXQ8Ym9vbD4oIklzUHJpbnRhYmxlIikpDQogICAgICAgICAgICAgICAgICAgIHsgIz4NCiAgICAgICAgICAgICAgICAgICAgPHRkIHdpZHRoPScxMCUnPnt0OlRhc2tIaXN0b3J5LkNyZWF0ZWQ6ZGQuTU0ueXl5eSBISFw6bW19PC90ZD4NCiAgICAgICAgICAgICAgICAgPCMgfSAjPg0KICAgICAgICAgICAgICAgICAgICA8IS0tIENvbXBsZXRlZCBDb2x1bW4gYmVnaW4gLS0+DQogICAgICAgICAgICAgICAgICAgIDx0ZCB3aWR0aD0nMTAlJz57dDpUYXNrSGlzdG9yeS5Db21wbGV0ZWQ6ZGQuTU0ueXl5eSBISFw6bW19PCMNCiAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIGlmIChpdGVtLkNvbXBsZXRlZFF1YW50cy5IYXNWYWx1ZSkNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgdGV4dEJ1aWxkZXIuQXBwZW5kRm9ybWF0KCIgKHswfSkiLCAoaXRlbS5Db21wbGV0ZWRRdWFudHMuVmFsdWUgPCAwID8gInskRm9ybWF0X0RhdGVEaWZmX092ZXJkdWV9Jm5ic3A7IiA6IG51bGwpICsgRm9ybWF0dGluZ0hlbHBlci5Gb3JtYXREYXRlRGlmZihpdGVtLkNvbXBsZXRlZFF1YW50cy5WYWx1ZSkuUmVwbGFjZSgiICIsICImbmJzcDsiKSk7DQogICAgICAgICAgICAgICAgICAgIH0gIz4NCiAgICAgICAgICAgICAgICAgICAgPC90ZD4NCiAgICAgICAgICAgICAgICAgICAgPCEtLSBDb21wbGV0ZWQgQ29sdW1uIGVuZCAtLT4NCiAgICAgICAgICAgICAgICAgICAgPHRkIHdpZHRoPSc8Iz0gY29udGV4dC5JbmZvLkdldDxzdHJpbmc+KCJSZXN1bHRQZXJjZW50IikgIz4lJyBzdHlsZT0ndGV4dC1hbGlnbjpsZWZ0Jz57dDpUYXNrSGlzdG9yeS5SZXN1bHR9DQogICAgICAgICAgICAgICAgICAgIDwjDQogICAgICAgICAgICAgICAgICAgIGlmIChpdGVtLkZpbGVzICE9IG51bGwgJiYgaXRlbS5GaWxlcy5Db3VudCA+IDANCiAgICAgICAgICAgICAgICAgICAgICAgICYmICghY29udGV4dC5JbmZvLkdldDxib29sPigiV2ViQ2xpZW50IikNCiAgICAgICAgICAgICAgICAgICAgICAgIHx8ICFzdHJpbmcuSXNOdWxsT3JFbXB0eShjb250ZXh0LkluZm8uR2V0PHN0cmluZz4oIldlYkFkZHJlc3MiKSkpKQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXN0cmluZy5Jc051bGxPcldoaXRlU3BhY2UoYXdhaXQgY29udGV4dC5HZXRWYWx1ZUZyb21QbGFjZWhvbGRlckFzeW5jPHN0cmluZz4oInQ6VGFza0hpc3RvcnkuUmVzdWx0IikpKQ0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRleHRCdWlsZGVyLkFwcGVuZCgiPGJyLz4iKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGZvcm1hdEZpbGVMaW5rRnVuYyA9IGNvbnRleHQuSW5mby5HZXQ8RnVuYzxLckhpc3RvcnlGaWxlSXRlbSwgc3RyaW5nPj4oIkZvcm1hdEZpbGVMaW5rRnVuYyIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbS5GaWxlcy5Db3VudCA9PSAxKQ0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRleHRCdWlsZGVyLkFwcGVuZCgieyRBcHByb3ZhbEhpc3RvcnlfRmlsZUNoYW5nZWR9ICIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRleHRCdWlsZGVyLkFwcGVuZChmb3JtYXRGaWxlTGlua0Z1bmMoaXRlbS5GaWxlc1swXSkpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRleHRCdWlsZGVyLkFwcGVuZCgieyRBcHByb3ZhbEhpc3RvcnlfRmlsZUNoYW5nZWR9ICIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRleHRCdWlsZGVyLkFwcGVuZChzdHJpbmcuSm9pbigiLCAiLCBpdGVtLkZpbGVzLlNlbGVjdChmb3JtYXRGaWxlTGlua0Z1bmMpKSk7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgIz48L3RkPg0KICAgICAgICAgICAgICAgIDwvdHI+DQogICAgICAgICAgICAgICAgPC9fcm93Pg0KICAgICAgICAgICAgPC90YWJsZT4NCiAgICAgICAgPC9kaXY+DQogICAgICAgIDwvX2dyb3VwPg0KICAgICAgICA8IS0tIEN5Y2xlIEJvZHkgZW5kIC0tPg0KICAgICAgICA8IS0tIFRhc2sgSGlzdG9yeSBlbmQgLS0+DQogICAgICAgIDwjIA0KICAgICAgICB9IC8qIGhpc3RvcnlJdGVtcy5Db3VudCA+IDAgKi8gIz4NCiAgICAgICAgPCEtLSBCb3R0b20gYmVnaW4gLS0+PCEtLSBCb3R0b20gZW5kIC0tPg0KICAgIDwvYm9keT4NCjwvaHRtbD4="
  }
]